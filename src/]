#include "random_dense_system.hpp"
#include <iostream>
extern "C" { 
  #include "kaczmarz.h" 
} 
#include "gtest/gtest.h"
TEST_P(KaczmarzSerialDenseCorrectnessSmall, AgreesWithEigen){
  for (int i = 0; i < 30; i++){
    unsigned dim = 10;
    double *A = (double *)malloc(sizeof(double)*dim*dim);
    double *b = (double *)malloc(sizeof(double)*dim);
    double *x = (double *)malloc(sizeof(double)*dim);
    
    get_dense_linear_system(A, b, x, dim); //get randomised system

    kaczmarz_solver(A, b, x_kaczmarz, dim, dim, 10000*dim, 1e-10);//solve randomised system, max iterations steps

    double *x_kaczmarz = (double *)malloc(sizeof(double)*dim);
    for (unsigned i = 0; i < dim; i++){
         ASSERT_LE(std::abs(x[i] - x_kaczmarz[i]), 1e-7);
    }
    free(A);
    free(b);
    free(x);
  }
}


TEST_P(KaczmarzSerialDenseCorrectnessMedium, AgreesWithEigen){
  for (int i = 0; i < 30; i++){
    unsigned dim = 100;
    double *A = (double *)malloc(sizeof(double)*dim*dim);
    double *b = (double *)malloc(sizeof(double)*dim);
    double *x = (double *)malloc(sizeof(double)*dim);
    
    get_dense_linear_system(A, b, x, dim); //get randomised system

    kaczmarz_solver(A, b, x_kaczmarz, dim, dim, 10000*dim, 1e-10);//solve randomised system, max iterations steps

    double *x_kaczmarz = (double *)malloc(sizeof(double)*dim);
    for (unsigned i = 0; i < dim; i++){
         ASSERT_LE(std::abs(x[i] - x_kaczmarz[i]), 1e-7);
    }
    free(A);
    free(b);
    free(x);
  }
}
  
  
TEST_P(KaczmarzSerialDenseCorrectnessLarge, AgreesWithEigen){
  for (int i = 0; i < 30; i++){
    unsigned dim = 1000;
    double *A = (double *)malloc(sizeof(double)*dim*dim);
    double *b = (double *)malloc(sizeof(double)*dim);
    double *x = (double *)malloc(sizeof(double)*dim);
    
    get_dense_linear_system(A, b, x, dim); //get randomised system

    kaczmarz_solver(A, b, x_kaczmarz, dim, dim, 10000*dim, 1e-10);//solve randomised system, max iterations steps

    double *x_kaczmarz = (double *)malloc(sizeof(double)*dim);
    for (unsigned i = 0; i < dim; i++){
         ASSERT_LE(std::abs(x[i] - x_kaczmarz[i]), 1e-7);
    }
    free(A);
    free(b);
    free(x);
  }
}

int main() {
  std::srand(6);

  for (int i = 5; i < 1500; i += 5){


  }
